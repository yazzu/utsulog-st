services:
  utsulog-st:
    build: .
    container_name: utsulog-st
    working_dir: /app
    user: "1000:1000"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - HF_HOME=/app/.cache/huggingface
      # matplotlibなどがキャッシュを作ろうとする場合の対策
      - MPLCONFIGDIR=/app/.cache/matplotlib
      # その他HOMEを/appに向けておくと無難
      - HOME=/app
    volumes:
      # 現在のディレクトリをコンテナ内の /app にマウント
      - .:/app
    # 起動し続けるように設定
    tty: true
    stdin_open: true
    # GPUを使用するための設定 (NVIDIA Container Toolkitが必要)
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [ gpu ]